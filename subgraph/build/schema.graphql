# ============ Entities ============

"""
Token entity representing a tracked cryptocurrency.
"""
type Token @entity {
  "Token address"
  id: ID!
  
  "Token contract address"
  address: Bytes!
  
  "Current sentiment score (-1e18 to +1e18)"
  currentScore: BigInt!
  
  "Current confidence level (0-10000 basis points)"
  currentConfidence: Int!
  
  "Current sample size"
  currentSampleSize: Int!
  
  "Last update timestamp"
  lastUpdated: BigInt!
  
  "Whether the token is currently whitelisted"
  isWhitelisted: Boolean!
  
  "Total number of updates"
  updateCount: BigInt!
  
  "All sentiment updates for this token"
  updates: [SentimentUpdate!]! @derivedFrom(field: "token")
  
  "Daily aggregated data"
  dailyData: [DailySentiment!]! @derivedFrom(field: "token")
  
  "Hourly aggregated data"
  hourlyData: [HourlySentiment!]! @derivedFrom(field: "token")
  
  "Circuit breaker triggers"
  circuitBreakerEvents: [CircuitBreakerEvent!]! @derivedFrom(field: "token")
}

"""
Individual sentiment update event.
"""
type SentimentUpdate @entity {
  "Transaction hash + log index"
  id: ID!
  
  "Token this update belongs to"
  token: Token!
  
  "Sentiment score (-1e18 to +1e18)"
  score: BigInt!
  
  "Confidence level (0-10000 basis points)"
  confidence: Int!
  
  "Sample size (number of posts analyzed)"
  sampleSize: Int!
  
  "Block number"
  blockNumber: BigInt!
  
  "Block timestamp"
  timestamp: BigInt!
  
  "Transaction hash"
  transactionHash: Bytes!
}

"""
Daily aggregated sentiment data.
"""
type DailySentiment @entity {
  "Token address + day timestamp"
  id: ID!
  
  "Token this data belongs to"
  token: Token!
  
  "Day start timestamp (00:00 UTC)"
  dayTimestamp: BigInt!
  
  "Average score for the day"
  averageScore: BigInt!
  
  "Highest score"
  highScore: BigInt!
  
  "Lowest score"
  lowScore: BigInt!
  
  "Opening score (first of day)"
  openScore: BigInt!
  
  "Closing score (last of day)"
  closeScore: BigInt!
  
  "Number of updates"
  updateCount: BigInt!
}

"""
Hourly aggregated sentiment data.
"""
type HourlySentiment @entity {
  "Token address + hour timestamp"
  id: ID!
  
  "Token this data belongs to"
  token: Token!
  
  "Hour start timestamp"
  hourTimestamp: BigInt!
  
  "Average score for the hour"
  averageScore: BigInt!
  
  "Highest score"
  highScore: BigInt!
  
  "Lowest score"
  lowScore: BigInt!
  
  "Number of updates"
  updateCount: BigInt!
}

"""
Circuit breaker trigger event.
"""
type CircuitBreakerEvent @entity {
  "Transaction hash + log index"
  id: ID!
  
  "Token that triggered the circuit breaker"
  token: Token!
  
  "Reason code for the circuit break"
  reason: Int!
  
  "Block timestamp"
  timestamp: BigInt!
  
  "Transaction hash"
  transactionHash: Bytes!
}

"""
Global oracle statistics.
"""
type OracleStats @entity {
  "Always 'stats'"
  id: ID!
  
  "Total number of tokens ever tracked"
  totalTokens: BigInt!
  
  "Currently whitelisted tokens"
  activeTokens: BigInt!
  
  "Total sentiment updates across all tokens"
  totalUpdates: BigInt!
  
  "Whether the oracle is currently paused"
  isPaused: Boolean!
  
  "Last update timestamp"
  lastUpdate: BigInt!
  
  "Total circuit breaker triggers"
  circuitBreakerTriggers: BigInt!
}
